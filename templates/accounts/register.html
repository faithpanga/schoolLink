{% extends 'base.html' %}
{% block content %}
<style>
    /* This ensures the phone number input with its dropdown fits perfectly in the grid. */
    .iti {
        width: 100%;
        display: block; /* Ensures it behaves like other form controls */
    }
</style>

<div class="flex justify-center items-center py-10">
    <div class="card w-full max-w-4xl bg-base-100 shadow-xl">
        <div class="card-body p-8 md:p-10">
            <h2 class="card-title text-3xl justify-center mb-6">Create a Teacher Account</h2>

            <form method="post">
                {% csrf_token %}

                <!-- 
                    This is the responsive multi-column grid.
                    - 1 column on small screens (default)
                    - 2 columns on medium screens (`md:grid-cols-2`)
                    - 3 columns on large screens (`lg:grid-cols-3`)
                -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-6 gap-y-4">

                    <!-- First Name -->
                    <label class="form-control w-full">
                        <div class="label"><span class="label-text">{{ form.first_name.label }}</span></div>
                        {{ form.first_name }}
                        {% for error in form.first_name.errors %}<div class="label"><span class="label-text-alt text-error">{{ error }}</span></div>{% endfor %}
                    </label>

                    <!-- Last Name -->
                    <label class="form-control w-full">
                        <div class="label"><span class="label-text">{{ form.last_name.label }}</span></div>
                        {{ form.last_name }}
                        {% for error in form.last_name.errors %}<div class="label"><span class="label-text-alt text-error">{{ error }}</span></div>{% endfor %}
                    </label>

                    <!-- Email -->
                    <label class="form-control w-full">
                        <div class="label"><span class="label-text">{{ form.email.label }}</span></div>
                        {{ form.email }}
                        {% for error in form.email.errors %}<div class="label"><span class="label-text-alt text-error">{{ error }}</span></div>{% endfor %}
                    </label>

                    <!-- Phone Number -->
                    <label class="form-control w-full">
                        <div class="label"><span class="label-text">{{ form.phone_number.label }}</span></div>
                        {{ form.phone_number }}
                        {% for error in form.phone_number.errors %}<div class="label"><span class="label-text-alt text-error">{{ error }}</span></div>{% endfor %}
                    </label>

                    <!-- New Password -->
                    <label class="form-control w-full">
                        <div class="label"><span class="label-text">{{ form.new_password1.label }}</span></div>
                        {{ form.new_password1 }}
                        {% for error in form.new_password1.errors %}<div class="label"><span class="label-text-alt text-error">{{ error }}</span></div>{% endfor %}
                    </label>

                    <!-- Confirm Password -->
                    <label class="form-control w-full">
                        <div class="label"><span class="label-text">{{ form.new_password2.label }}</span></div>
                        {{ form.new_password2 }}
                        {% for error in form.new_password2.errors %}<div class="label"><span class="label-text-alt text-error">{{ error }}</span></div>{% endfor %}
                    </label>
                </div>
                
                <!-- Display any non-field errors from the server -->
                {% if form.non_field_errors %}
                    <div class="alert alert-error text-sm mt-6">
                        <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                        <span>{{ form.non_field_errors|first }}</span>
                    </div>
                {% endif %}

                <!-- Actions -->
                <div class="card-actions justify-center mt-8">
                    <button type="submit" class="btn btn-primary btn-wide">Create Account</button>
                </div>
                
                <p class="text-center text-sm pt-4">
                    Already have an account?
                    <a href="{% url 'login' %}" class="link link-primary">Sign In</a>
                </p>
            </form>
        </div>
    </div>
</div>

<script>
    const phoneInput = document.querySelector('#phone_number_input');
    if (phoneInput) {
        window.intlTelInput(phoneInput, {
            utilsScript: 'https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.19/js/utils.js',
            initialCountry: 'auto',
            geoIpLookup: (callback) => {
                fetch('https://ipapi.co/json')
                .then((res) => res.json())
                .then((data) => callback(data.country_code))
                .catch(() => callback('us'));
            }
        });
    }
</script>
{% endblock %}